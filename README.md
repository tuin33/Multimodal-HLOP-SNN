# Multimodal-HLOP-SNN
我们小组基于Hebbian Learning based Orthogonal Projection for Continual Learning of Spiking Neural Networks **(ICLR 2024)**. \[[openreview](https://openreview.net/forum?id=MeB86edZ1P)\] \[[arxiv](https://arxiv.org/abs/2402.11984)\]，基于论文代码，实现一个基于多模态的持续学习的分类任务。

## 改进点：多模态分类任务的扩展
本项目将原有的单模态图像分类任务扩展为多模态任务，结合图像和音频信息进行分类。本项目将原有的单模态图像分类任务扩展为多模态分类任务，融合了图像和音频两种信息输入，以实现更为复杂和精准的分类。传统的单模态图像分类任务通常只利用视觉信息进行学习和推理，限制了模型的表现能力。而在现实世界中，许多任务都涉及到多种感知信息的交互，例如视觉与听觉的结合，这种跨模态的信息融合对于提高模型的泛化能力和鲁棒性至关重要。通过这一改进，模型能够处理更复杂的信息输入，并在多源信息融合方面展现出较强的能力。

## 模型框架

我们参考SNN多模态融合框架，搭建一个网络用于融合图像与语音特征，框架位于`./models/spiking_mlp_hlop_multimodal.py`

![项目框架](./result/model.png)

本项目架构包括多模态特征融合、持续学习和SNN机制：

1. 多模态特征融合
   
该模块包含三个子网络：
视觉模态子网络：使用卷积型SNN处理动态视觉传感器（DVS）生成的图像数据，捕捉空间特征，保留稀疏性和高效性。
听觉模态子网络：采用全连接型SNN处理动态音频传感器（DAS）生成的音频数据，专注于时间特征。
跨模态子网络：基于注意力机制动态融合视觉和听觉信息，根据模态重要性自适应加权，提升模型的鲁棒性。
通过使用DVS和DAS传感器，系统模拟人类感官的异步事件驱动和稀疏数据表示，实现高效的特征处理。

2. 持续学习与SNN机制
   
本项目引入 赫比学习的正交投影（HLOP） 方法，通过横向神经连接和赫比规则，支持新任务学习的同时保持旧任务记忆，避免灾难性遗忘。该方法使SNN能够在增量学习中动态调整策略，保持对历史任务的高性能。

3. SNN机制与稀疏特征
   
SNN利用脉冲传播机制，提取稀疏特征，显著提高计算效率和存储利用率。稀疏特征有助于避免过拟合，提高模型的泛化能力，并增强可解释性。

本项目通过多模态融合、赫比学习和SNN机制的结合，提升了分类精度、鲁棒性和持续学习能力，适用于处理多模态数据和增量任务。

## Dependencies and Installation
- Python 3 (Recommend to use [Anaconda](https://www.anaconda.com/download/#linux))
- [PyTorch, torchvision](https://pytorch.org/)
- NVIDIA GPU + [CUDA](https://developer.nvidia.com/cuda-downloads)
- Python packages: `pip install numpy opencv-python`

## Training

### Datasets
数据集使用含有图像和音频的多模态分类数据集，来自Kaggle网站https://www.kaggle.com/datasets/birdy654/scene-classification-images-and-audio

该数据集包含了来自8个不同环境的视频图像和音频数据，包括如城市街道、森林、海滩、乡村等。
数据来自37个视频源，这些视频分别记录了8种不同环境下的场景。每秒钟从视频中提取一张图像，提取的图像帧为0.5秒、1.5秒、2.5秒……的帧。

使用该指令下载场景分类数据集，将数据集移动到`./datasets`
```bash
python ./datasets/download.py
```
数据集包括一个图片文件夹以及一个datasets.svc文件，datasets.svc后第1行到105行代表语音信息。

将数据集划分成不同的子任务，用于持续学习，可以根据需要自行修改
```bash
python ./dataloader/scene.py
```

数据集部分展示：
| IMAGE                                 | mfcc_1     | mfcc_2     | mfcc_3     | mfcc_4     | mfcc_5     | ... |
|---------------------------------------|------------|------------|------------|------------|------------|-----|
| images/forest/forest0.png            | 15.79538389 | -3.44251778 | -25.316836 | -33.412103 | 2.44728978 | ... |
| images/london/london0.png            | 13.67319227 | 4.42548796 | -14.410638 | -16.059232 | -11.522731 | ... |
| images/beach/beach0.png              | 15.07820579 | 2.30527753 | -4.1994111 | -20.055079 | 14.7210576 | ... |
| ...             | ... | ... | ... | ... | ... | ... |


### Usage

#### 多模态信息特征提取预训练

由于SNN和ANN无法共用统一的训练方法，因此先单独对以ANN为主题的多模态信息融合部分进行预训练，使得网络能够实现对多模态信息（图像和音频）较好的特征提取，权重保存在`./pre_weight/scene`

```bash
python spiking_pretrain_multimodal.py 
```

#### 训练

正式训练时使用预训练权重来对多模态信息进行提取和融合，并作为特征表示输入hlop和snn网络中

##### baseline
```bash
python spiking_train_multimodal_end.py  -out_dir log_checkpoint_name -baseline -gpu-id 0
```

##### 多模态HLOP
```bash
python spiking_train_multimodal_end.py  -out_dir log_checkpoint_name -hlop_spiking -hlop_spiking_scale 20. -hlop_spiking_timesteps 40 -gpu-id 0
```

### Results

#### 无持续学习
  
| Task1     | Task2     | Task3     | Task4     | Task5     |
|-----------|-----------|-----------|-----------|-----------|
| 97.9%  | \ | \ | \ | \ |
| 89.4%  | 97.9% | \ | \ | \ |
| 90.4%  | 97.6% | 98.8% | \ | \ |
| 0.0%   | 49.4% | 0.0% | 54.7% | \ |
| 0.0%   | 0.0%  | 0.0% | 35.9% | 95.7% |

#### 多模态持续学习 

| Task1     | Task2     | Task3     | Task4     | Task5     |
|-----------|-----------|-----------|-----------|-----------|
| 100.0%  | \ | \ | \ | \ |
| 98.9%  | 100.0% | \ | \ | \ |
| 97.9%  | 98.8% | 98.8% | \ | \ |
| 96.8%   | 100.0% | 98.8% | 92.2% | \ |
| 98.9%   | 100.0%  | 98.8% | 92.2% | 100.0% |


#### 单模态持续学习 

##### 语音 

| Task1     | Task2     | Task3     | Task4     | Task5     |
|-----------|-----------|-----------|-----------|-----------|
| 97.9%  | \ | \ | \ | \ |
| 89.4%  | 97.6% | \ | \ | \ |
| 90.4%  | 97.6% | 98.8% | \ | \ |
| 0.0%   | 49.4% | 0.0% | 54.7% | \ |
| 0.0%   | 0.0%  | 0.0% | 35.9% | 95.7% |

##### 图像 
  
| Task1     | Task2     | Task3     | Task4     | Task5     |
|-----------|-----------|-----------|-----------|-----------|
| 100.0% | \ | \ | \ | \ |
| 77.7%  | 88.0% | \ | \ | \ |
| 0.0%   | 25.3% | 76.5% | \ | \ |
| 0.0%   | 47.0% | 0.0%  | 92.2% | \ |
| 0.0%   | 44.6% | 0.0% | 0.0% | 82.6% |

